<!DOCTYPE HTML>
<html>
    <head>
        <meta charset="UTF-8">
        <title>Club Ciné</title>
        <!-- CDN -->
        <!-- Font Awesome -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
        <!-- jQuery -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
        <!-- jQuery UI -->
        <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/smoothness/jquery-ui.css">
        <!-- Database Wrapper -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/dexie/1.5.1/dexie.min.js"></script>
        <!-- Semantic OwO -->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.10/semantic.min.css">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.10/semantic.min.js"></script>
        <!-- three.js -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/85/three.min.js"></script>
        <!-- JsRender -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jsrender/0.9.84/jsrender.min.js"></script>

        <!-- analytics -->
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-101944034-1', 'auto');
            ga('send', 'pageview');
        </script>

        <!-- templates -->
        <script id="table-row-template" type="text/html">
            <tr class="song-row" data-songid="{{:id}}">
                <td class="db-song-control">
                    <div><a onclick="Database.handlePlay({{:id}})" class="fa fa-play interactable"></a></div>
                </td>
                <td class="row-art"><img width="50px" src="{{>img || './img/art_ph.png'}}"></td>
                <td class="row-title"><div>{{:title}}</div></td>
                <td class="row-artist"><div>{{:artist}}</div></td>
                <td><div>{{:duration}}</div></td>
                <td class="db-song-control">
                    <div><a onclick="Database.handleRemove({{:id}})" class="fa fa-trash interactable"></a></div>
                </td>
            </tr>
        </script>

        <!-- Local -->
        <!-- Styles -->
        <link rel="stylesheet" type="text/css" href="./css/main.css">
        <link rel="stylesheet" type="text/css" href="./css/gui.css">
        <link rel="stylesheet" type="text/css" href="./css/background.css">
        <style>
            #quiz-qr-panel {
                position: fixed;
                bottom: 70px;
                right: 20px;
                padding: 12px 14px 10px;
                background: rgba(0, 0, 0, 0.78);
                color: #f3f4f6;
                border: 1px solid rgba(255, 255, 255, 0.18);
                border-radius: 14px;
                box-shadow: 0 12px 28px rgba(0, 0, 0, 0.35);
                transform: translateY(12px);
                opacity: 0;
                pointer-events: none;
                transition: opacity 160ms ease, transform 160ms ease;
                z-index: 9999;
                width: 240px;
                text-align: center;
            }
            #quiz-qr-panel.visible {
                opacity: 1;
                transform: translateY(0);
                pointer-events: auto;
            }
            #quiz-qr {
                width: 210px;
                height: 210px;
                display: block;
                margin: 4px auto 6px;
                border-radius: 10px;
                background: #fff;
            }
            #quiz-qr-panel .qr-title {
                font-weight: 700;
                letter-spacing: 0.02em;
                margin: 0 0 2px;
                color: #facc15;
            }
            #quiz-qr-panel .qr-sub {
                margin: 0;
                font-size: 13px;
                color: #e5e7eb;
            }
            #quiz-qr-close {
                position: absolute;
                top: 6px;
                right: 8px;
                cursor: pointer;
                color: #f3f4f6;
                font-size: 14px;
                opacity: 0.8;
            }
            #quiz-qr-close:hover {
                opacity: 1;
            }
            #qr-hint {
                position: fixed;
                bottom: 10px;
                right: 24px;
                color: #e5e7eb;
                background: rgba(0, 0, 0, 0.55);
                padding: 6px 10px;
                border-radius: 999px;
                font-size: 12px;
                letter-spacing: 0.03em;
                box-shadow: 0 6px 12px rgba(0, 0, 0, 0.25);
                z-index: 9998;
            }
        </style>
        <!-- audio -->
        <script src="./js/audio/nodes.js"></script>
        <!-- math -->
        <script src="./js/math/math_constants.js"></script>
        <script src="./js/math/transform.js"></script>
        <!-- misc -->
        <script src="./js/misc/callbacks.js"></script>
        <script src="./js/misc/config.js"></script>
        <script src="./js/misc/util.js"></script>
        <script src="./js/misc/database.js"></script>
        <script src="./js/misc/id3-minimized.js"></script>
        <script src="./js/misc/io_handler.js"></script>
        <!-- model -->
        <script src="./js/model/particle_data.js"></script>
        <script src="./js/model/priority.js"></script>
        <script src="./js/model/song.js"></script>
        <!-- visual -->
        <script src="./js/visual/background.js"></script>
        <!-- visual/emblem -->
        <script src="./js/visual/drawn/canvas.js"></script>
        <script src="./js/visual/drawn/emblem.js"></script>
        <script src="./js/visual/drawn/spectrum.js"></script>
        <!-- visual/gl -->
        <script src="./js/visual/gl/lighting.js"></script>
        <script src="./js/visual/gl/particles.js"></script>
        <script src="./js/visual/gl/renderer.js"></script>
        <script src="./js/visual/gl/scene.js"></script>
        <script src="./js/visual/gl/shaders.js"></script>
        <!-- visual/gui -->
        <script src="./js/visual/gui/banner.js"></script>
        <script src="./js/visual/gui/countdown.js"></script>
        <script src="./js/visual/gui/audio_wrap.js"></script>
        <script src="./js/visual/gui/gui_wrapper.js"></script>
        <!-- root -->
        <script src="./js/main.js"></script>
        <!-- QR generation -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"></script>
    </head>
    <body>
        <div id="gui-full" class="overlay-container">
            <div class="vert-cen overlay-window" id="gui-full-holder">
                <div class="absolute-center overlay-pane" id="controls">
                    <div id="db-prev" class="page-control interactable fa fa-chevron-circle-left"
                            onClick="Database.prevPage()" title="Previous page"></div>
                    <div id="db-next" class="page-control interactable fa fa-chevron-circle-right"
                            onClick="Database.nextPage()" title="Next page"></div>
                    <div onClick="GuiWrapper.closeGui();" class="boxclose fa fa-times-circle interactable"></div>
                    <div class="ui fluid action input inverted">
                        <input type="text" readonly Value="Select Audio File">
                        <input accept="audio/*" type="file" id="fileSelector">
                        <div id="upload-button" class="ui icon button interactable">
                            <span class="fa fa-plus"></span>
                        </div>
                    </div>
                    <table class="ui selectable inverted table" id="db-view" border="1"></table>
                    <div id="db-page-info">Page ??/??</div>
                    <div id="db-input">
                        <div class="ui input">
                            <input type="text" id="field-artist" placeholder="Artist" disabled>
                        </div>
                        <div class="ui input">
                            <input type="text" id="field-title" placeholder="Title" disabled>
                        </div>
                    </div>
                    <div id="db-controls">
                        <button class="ui button interactable" id="add2DB" disabled>Add To Library</button>
                        <button class="ui button interactable" id="viewDB">Refresh Library</button>
                        <button class="ui button interactable" id="delDB">Delete Library</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="about-full" class="overlay-container">
            <div class="vert-cen overlay-window" id="about-full-holder">
                <div class="absolute-center overlay-pane" id="about-pane">
                    <div onClick="GuiWrapper.closeAbout();" class="boxclose fa fa-times-circle interactable"></div>
                    <div id="about-header">
                        js.nation
                    </div>
                    <div id="about-content">
                        <div>
                            made with <span class="fa fa-heart"></span> by 
                            <a href="//caseif.net" target="_blank" rel="noopener noreferrer">caseif</a> & 
                            <a href="http://incept.online" target="_blank" rel="noopener noreferrer">incept</a>
                        </div>
                        <div>
                            source available on
                            <a href="//github.com/caseif/js.nation" target="_blank" rel="noopener noreferrer">github</a>
                        </div>
                        <div>
                            <a href="technologies.html" target="_blank" rel="noopener noreferrer">technologies used</a>
                        </div>
                        <div>
                            inspired by <a href="//nations.io/">the nations</a>
                        </div>
                        <hr>
                        <div>
                            hotkeys
                        </div>
                        <div id="about-hotkeys">
                            f &mdash; flip background
                            <br>
                            g &mdash; toggle spectrum glow
                            <br>
                            space &mdash; play/pause
                            <br>
                            escape &mdash; close overlay
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!--
        <div class="flex gui-part" id="gui-top">
            <div id="song-info">
                <div id="gui-artist"></div>
                <div id="gui-title"></div>
            </div>
        </div> 
        -->

        <div id="ticker">
            <div id="ticker-track">
                <span id="ticker-text"></span>
            </div>
        </div>
        

        <div class="flex gui-part" id="gui-bottom">
            <!-- Center -->
            <div id="audio-player">  
                <div class="flex main-controls">
                    <span id="about-btn" class="fa fa-info-circle action interactable" title="About"></span>
                    <span id="playlist" class="fa fa-list-ul interactable" title="Playlist" onClick="GuiWrapper.openGui();"></span>
                    <span id="previous" class="fa fa-step-backward interactable" onClick="Database.playPrevSong()"></span>
                    <span id="play" class="fa fa-pause action interactable"></span>
                    <span id="next" class="fa fa-step-forward action interactable" onClick="Database.playNextSong()"></span>
                    <span id="shuffle" class="fa fa-random action interactable" onClick="Database.toggleShuffle()"></span>
                </div>
                <span id="time" class="time">00:00</span>
                <progress id="progressbar" class="flex-auto interactable" value="0" max="100"></progress>
                <div id="volume-group">
                    <span id="mute" class="fa fa-volume-up interactable"></span>
                    <progress id="volume" class="flex-auto interactable" value="100" max="100"></progress>
                </div>
            </div>
            <audio id="audio" onended="Database.playNextSong()"></audio>
            <input type="file" id="videoSelector" accept="video/mp4" style="display:none">
            <!-- Right -->
            <div id="elm-about">
                <a href="javascript:GuiWrapper.openAbout();">About</a>
            </div>
        </div>

        <div id="content">
            <canvas id="canvas" style="display: block;"></canvas>
        </div>
        <div id="background" class="lazyaf">
            <img src="" class="bgleft" id="limg1" onerror="this.style.display='none'">
            <img src="" class="bgright" id="limg2" onerror="this.style.display='none'">
        </div>
        <div id="background" class="realbg">
            <video id="bgvideo" muted loop playsinline></video>
            <img src="" class="bgleft" id="bgimg1" onload="Background.fadeFullRes(this)"
                    onerror="this.style.display='none'">
            <img src="" class="bgright" id="bgimg2" onload="Background.fadeFullRes(this)"
                    onerror="this.style.display='none'">
        </div>

        <div id="countdown" title="Clique pour régler le compte à rebours"></div>
        <div id="now-playing" class="paused">
            <span id="now-playing-text">Aucune lecture</span>
        </div>

        <div id="quiz-qr-panel">
            <p class="qr-title">Quiz Club Ciné</p>
            <p class="qr-sub">Scannez pour jouer</p>
            <canvas id="quiz-qr" aria-label="QR code vers le quiz"></canvas>
        </div>

        <script>
            (function(){
                const panel = document.getElementById('quiz-qr-panel');
                const qrCanvas = document.getElementById('quiz-qr');
                const closeBtn = document.getElementById('quiz-qr-close');
                const hint = document.getElementById('qr-hint');
                let qrReady = false;

                function ensureQr() {
                    if (qrReady || !window.QRious || !qrCanvas) return;
                    const url = `${location.origin}/quiz/`;
                    new QRious({
                        element: qrCanvas,
                        value: url,
                        size: 210,
                        background: '#ffffff',
                        foreground: '#111827',
                        level: 'H'
                    });
                    qrReady = true;
                }

                function toggleQr() {
                    if (!panel) return;
                    const show = !panel.classList.contains('visible');
                    if (show) ensureQr();
                    panel.classList.toggle('visible', show);
                }

                document.addEventListener('keydown', (ev) => {
                    if (ev.key && ev.key.toLowerCase() === 'q' && !ev.metaKey && !ev.ctrlKey && !ev.altKey) {
                        ev.preventDefault();
                        toggleQr();
                    }
                });

                if (closeBtn) closeBtn.addEventListener('click', toggleQr);
                if (hint) hint.addEventListener('click', toggleQr);
            })();
        </script>
    </body>
</html>
